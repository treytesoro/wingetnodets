<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Wingetnode resource page</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <style>
            @font-face {
            font-family: SpartanMB;
                src: url('SpartanMB-Regular.otf') format('truetype');
                font-weight: normal;
            }

            @font-face {
            font-family: SpartanMB;
                src: url('SpartanMB-Bold.otf') format('truetype');
                font-weight: bold;
            }

            @font-face {
            font-family: Montserrat;
                src: url('Montserrat-Regular.otf') format('truetype');
                font-weight: normal;
            }

            @font-face {
            font-family: Montserrat;
                src: url('Montserrat-Bold.otf') format('truetype');
                font-weight: bold;
            }

            @font-face {
            font-family: Montserrat;
                src: url('Montserrat-Italic.otf') format('truetype');
                font-weight: normal;
                font-style: italic;
            }

            @font-face {
            font-family: Montserrat;
                src: url('Montserrat-BoldItalic.otf') format('truetype');
                font-weight: bold;
                font-style: italic;
            }

            body {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                background-color: rgb(33, 41, 53);
                font-family: Montserrat;
                line-height: 150%;
            }

            .content {
                display: flex;
                flex-direction: column;
                width: 80%;
                min-width: 800px;
                max-width: 1000px;
                border-radius: 10px;;
                padding: 20px;
                background-color: white;
            }

            .inputfield {
                margin: 2px;
            }
            .inputfield label {
                display: inline-block;
                min-width: 250px;
                max-width: 250px;
                text-align: right;
                margin: 0px 10px;
            }
            .badpass {
                border-color: red;
            }
            h4 {
                color:rgb(62, 96, 148)
            }
        </style>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
        <div class="content">
            <h2>Welcome to WingetNode's resource pages.</h2>
            <div style="font-weight: bold;"><a href="/getpowershells">Download Powershell Helper files</a></div>
            <br/>
            <div>
                Use the powershell scripts to inspect packages and upload package manifests.<br/>
                Extract the zip file and edit <span style="font-weight: bold;">parserconfig.json</span>.<br/>
                Set <span style="font-weight: bold;">hostname</span> and <span style="font-weight: bold;">port</span> to your wingetnode server's host and port.
                <br/>
                <pre>
                    <span style="display: inline-block; border:solid 1px #999999; padding: 10px;">"ingestpackageURI": "https://hostname:port/api/package"</span>
                </pre>
            </div>

            <h3>Generate certificates</h3>
            <h4>Certificate Authority details</h4>
            <div class="inputfield">
                <label for="countrycode">Country:</label>
                <select id="countrycode">
                    <option value="AD">AD</option>
                    <option value="AE">AE</option>
                    <option value="AF">AF</option>
                    <option value="AG">AG</option>
                    <option value="AI">AI</option>
                    <option value="AL">AL</option>
                    <option value="AM">AM</option>
                    <option value="AO">AO</option>
                    <option value="AQ">AQ</option>
                    <option value="AR">AR</option>
                    <option value="AS">AS</option>
                    <option value="AT">AT</option>
                    <option value="AU">AU</option>
                    <option value="AW">AW</option>
                    <option value="AX">AX</option>
                    <option value="AZ">AZ</option>
                    <option value="BA">BA</option>
                    <option value="BB">BB</option>
                    <option value="BD">BD</option>
                    <option value="BE">BE</option>
                    <option value="BF">BF</option>
                    <option value="BG">BG</option>
                    <option value="BH">BH</option>
                    <option value="BI">BI</option>
                    <option value="BJ">BJ</option>
                    <option value="BL">BL</option>
                    <option value="BM">BM</option>
                    <option value="BN">BN</option>
                    <option value="BO">BO</option>
                    <option value="BQ">BQ</option>
                    <option value="BR">BR</option>
                    <option value="BS">BS</option>
                    <option value="BT">BT</option>
                    <option value="BV">BV</option>
                    <option value="BW">BW</option>
                    <option value="BY">BY</option>
                    <option value="BZ">BZ</option>
                    <option value="CA">CA</option>
                    <option value="CC">CC</option>
                    <option value="CD">CD</option>
                    <option value="CF">CF</option>
                    <option value="CG">CG</option>
                    <option value="CH">CH</option>
                    <option value="CI">CI</option>
                    <option value="CK">CK</option>
                    <option value="CL">CL</option>
                    <option value="CM">CM</option>
                    <option value="CN">CN</option>
                    <option value="CO">CO</option>
                    <option value="CR">CR</option>
                    <option value="CU">CU</option>
                    <option value="CV">CV</option>
                    <option value="CW">CW</option>
                    <option value="CX">CX</option>
                    <option value="CY">CY</option>
                    <option value="CZ">CZ</option>
                    <option value="DE">DE</option>
                    <option value="DJ">DJ</option>
                    <option value="DK">DK</option>
                    <option value="DM">DM</option>
                    <option value="DO">DO</option>
                    <option value="DZ">DZ</option>
                    <option value="EC">EC</option>
                    <option value="EE">EE</option>
                    <option value="EG">EG</option>
                    <option value="EH">EH</option>
                    <option value="ER">ER</option>
                    <option value="ES">ES</option>
                    <option value="ET">ET</option>
                    <option value="FI">FI</option>
                    <option value="FJ">FJ</option>
                    <option value="FK">FK</option>
                    <option value="FM">FM</option>
                    <option value="FO">FO</option>
                    <option value="FR">FR</option>
                    <option value="GA">GA</option>
                    <option value="GB">GB</option>
                    <option value="GD">GD</option>
                    <option value="GE">GE</option>
                    <option value="GF">GF</option>
                    <option value="GG">GG</option>
                    <option value="GH">GH</option>
                    <option value="GI">GI</option>
                    <option value="GL">GL</option>
                    <option value="GM">GM</option>
                    <option value="GN">GN</option>
                    <option value="GP">GP</option>
                    <option value="GQ">GQ</option>
                    <option value="GR">GR</option>
                    <option value="GS">GS</option>
                    <option value="GT">GT</option>
                    <option value="GU">GU</option>
                    <option value="GW">GW</option>
                    <option value="GY">GY</option>
                    <option value="HK">HK</option>
                    <option value="HM">HM</option>
                    <option value="HN">HN</option>
                    <option value="HR">HR</option>
                    <option value="HT">HT</option>
                    <option value="HU">HU</option>
                    <option value="ID">ID</option>
                    <option value="IE">IE</option>
                    <option value="IL">IL</option>
                    <option value="IM">IM</option>
                    <option value="IN">IN</option>
                    <option value="IO">IO</option>
                    <option value="IQ">IQ</option>
                    <option value="IR">IR</option>
                    <option value="IS">IS</option>
                    <option value="IT">IT</option>
                    <option value="JE">JE</option>
                    <option value="JM">JM</option>
                    <option value="JO">JO</option>
                    <option value="JP">JP</option>
                    <option value="KE">KE</option>
                    <option value="KG">KG</option>
                    <option value="KH">KH</option>
                    <option value="KI">KI</option>
                    <option value="KM">KM</option>
                    <option value="KN">KN</option>
                    <option value="KP">KP</option>
                    <option value="KR">KR</option>
                    <option value="KW">KW</option>
                    <option value="KY">KY</option>
                    <option value="KZ">KZ</option>
                    <option value="LA">LA</option>
                    <option value="LB">LB</option>
                    <option value="LC">LC</option>
                    <option value="LI">LI</option>
                    <option value="LK">LK</option>
                    <option value="LR">LR</option>
                    <option value="LS">LS</option>
                    <option value="LT">LT</option>
                    <option value="LU">LU</option>
                    <option value="LV">LV</option>
                    <option value="LY">LY</option>
                    <option value="MA">MA</option>
                    <option value="MC">MC</option>
                    <option value="MD">MD</option>
                    <option value="ME">ME</option>
                    <option value="MF">MF</option>
                    <option value="MG">MG</option>
                    <option value="MH">MH</option>
                    <option value="MK">MK</option>
                    <option value="ML">ML</option>
                    <option value="MM">MM</option>
                    <option value="MN">MN</option>
                    <option value="MO">MO</option>
                    <option value="MP">MP</option>
                    <option value="MQ">MQ</option>
                    <option value="MR">MR</option>
                    <option value="MS">MS</option>
                    <option value="MT">MT</option>
                    <option value="MU">MU</option>
                    <option value="MV">MV</option>
                    <option value="MW">MW</option>
                    <option value="MX">MX</option>
                    <option value="MY">MY</option>
                    <option value="MZ">MZ</option>
                    <option value="NA">NA</option>
                    <option value="NC">NC</option>
                    <option value="NE">NE</option>
                    <option value="NF">NF</option>
                    <option value="NG">NG</option>
                    <option value="NI">NI</option>
                    <option value="NL">NL</option>
                    <option value="NO">NO</option>
                    <option value="NP">NP</option>
                    <option value="NR">NR</option>
                    <option value="NU">NU</option>
                    <option value="NZ">NZ</option>
                    <option value="OM">OM</option>
                    <option value="PA">PA</option>
                    <option value="PE">PE</option>
                    <option value="PF">PF</option>
                    <option value="PG">PG</option>
                    <option value="PH">PH</option>
                    <option value="PK">PK</option>
                    <option value="PL">PL</option>
                    <option value="PM">PM</option>
                    <option value="PN">PN</option>
                    <option value="PR">PR</option>
                    <option value="PS">PS</option>
                    <option value="PT">PT</option>
                    <option value="PW">PW</option>
                    <option value="PY">PY</option>
                    <option value="QA">QA</option>
                    <option value="RE">RE</option>
                    <option value="RO">RO</option>
                    <option value="RS">RS</option>
                    <option value="RU">RU</option>
                    <option value="RW">RW</option>
                    <option value="SA">SA</option>
                    <option value="SB">SB</option>
                    <option value="SC">SC</option>
                    <option value="SD">SD</option>
                    <option value="SE">SE</option>
                    <option value="SG">SG</option>
                    <option value="SH">SH</option>
                    <option value="SI">SI</option>
                    <option value="SJ">SJ</option>
                    <option value="SK">SK</option>
                    <option value="SL">SL</option>
                    <option value="SM">SM</option>
                    <option value="SN">SN</option>
                    <option value="SO">SO</option>
                    <option value="SR">SR</option>
                    <option value="SS">SS</option>
                    <option value="ST">ST</option>
                    <option value="SV">SV</option>
                    <option value="SX">SX</option>
                    <option value="SY">SY</option>
                    <option value="SZ">SZ</option>
                    <option value="TC">TC</option>
                    <option value="TD">TD</option>
                    <option value="TF">TF</option>
                    <option value="TG">TG</option>
                    <option value="TH">TH</option>
                    <option value="TJ">TJ</option>
                    <option value="TK">TK</option>
                    <option value="TL">TL</option>
                    <option value="TM">TM</option>
                    <option value="TN">TN</option>
                    <option value="TO">TO</option>
                    <option value="TR">TR</option>
                    <option value="TT">TT</option>
                    <option value="TV">TV</option>
                    <option value="TW">TW</option>
                    <option value="TZ">TZ</option>
                    <option value="UA">UA</option>
                    <option value="UG">UG</option>
                    <option value="UM">UM</option>
                    <option value="US">US</option>
                    <option value="UY">UY</option>
                    <option value="UZ">UZ</option>
                    <option value="VA">VA</option>
                    <option value="VC">VC</option>
                    <option value="VE">VE</option>
                    <option value="VG">VG</option>
                    <option value="VI">VI</option>
                    <option value="VN">VN</option>
                    <option value="VU">VU</option>
                    <option value="WF">WF</option>
                    <option value="WS">WS</option>
                    <option value="YE">YE</option>
                    <option value="YT">YT</option>
                    <option value="ZA">ZA</option>
                    <option value="ZM">ZM</option>
                    <option value="ZW">ZW</option>
                </select>
            </div>
            <div class="inputfield">
                <label for="locality">Locality:</label>
                <input type="text" id="locality" />
            </div>
            <div class="inputfield">
                <label for="organization">Organization:</label>
                <input type="text" id="organization" />
            </div>
            <div class="inputfield">
                <label for="cacn">Common name:</label>
                <input type="text" id="cacn" />
            </div>
            <div class="inputfield">
                <label for="caemail">Email address:</label>
                <input type="text" id="caemail" />
            </div>
            <div class="inputfield">
                <label for="challengepwd1">Challenge password:</label>
                <input type="password" id="challengepwd1"/>
            </div>
            <div class="inputfield">
                <label for="challengepwd2">Challenge password (verify):</label>
                <input type="password" id="challengepwd2" />
            </div>

            <h4>Web server certificate details</h4>
            <div class="inputfield">
                <label for="san">Subject Alternate names:</label>
                <input type="text" id="san" />
            </div>
            <div style="text-align: right;">
                <button id="btncreatecerts">Create</button>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', ()=>{
                init();
            });
            
            let init=()=> {
                //var x = document.getElementById('');
                var btncreatecerts = document.getElementById('btncreatecerts');
                var capw1 = document.getElementById('challengepwd1');
                var capw2 = document.getElementById('challengepwd2');
                var countrycode = document.getElementById('countrycode');
                var locality = document.getElementById('locality');
                var organization = document.getElementById('organization');
                var cacn = document.getElementById('cacn');
                var caemail = document.getElementById('caemail');
                var san = document.getElementById('san');

                let getcerts=()=> {
                    console.log("Getting certs");

                    let reqData = {
                        countrycode: countrycode.value,
                        locality: locality.value,
                        organization: organization.value,
                        cacn: cacn.value,
                        caemail: caemail.value,
                        capw: capw1.value,
                        san: san.value
                    };

                    let xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange=function() {
                        if(this.readyState==4 && this.status==200){
                            console.log('ok');
                            console.log(xhttp.response);
                            let blob = new Blob([xhttp.response], {type:"application/zip"});
                            var a = document.createElement("a");
                            document.body.appendChild(a);
                            a.style = "display:none";
                            var url = window.URL.createObjectURL(blob);
                            a.href = url;
                            a.download = "newcerts.zip";
                            a.click();
                            window.URL.revokeObjectURL(url);
                            a.remove();
                        }
                    }
                    xhttp.responseType = "blob";
                    xhttp.open("POST", "/getcerts");
                    xhttp.setRequestHeader(
                        "Content-type",
                        "application/json"
                    );
                    xhttp.send(JSON.stringify(reqData));
                }

                btncreatecerts.addEventListener('click', getcerts);

                [capw1, capw2].forEach(capw=>{
                    capw.addEventListener('keyup', (e)=>{
                        passmatch(e);
                    });
                });

                let passmatch=(e)=> {
                    let ismatch = capw1.value==capw2.value;
                    if(!ismatch) {
                        capw1.classList.add('badpass');
                        capw2.classList.add('badpass');
                    }
                    else {
                        capw1.classList.remove('badpass');
                        capw2.classList.remove('badpass');
                    }
                    return ismatch;
                }
            }
        </script>
    </body>
</html>